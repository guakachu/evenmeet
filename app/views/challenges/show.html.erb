
  <% if @challenge.relationship.receiver.user == current_user %>
    <% target = @challenge.relationship.sender %>
  <% else %>
    <% target = @challenge.relationship.receiver %>
  <% end %>

  <div class="container challenge text-white"
    data-controller="challenge-subscription"
    data-challenge-subscription-challenge-id-value="<%= @challenge.id %>"
    style="margin-bottom: 65px;"
  >

    <h4 class="mt-2 mb-3"><%= "Chat with #{ target.user.first_name }" %></h4>

    <div class="messages d-flex flex-column" data-challenge-subscription-target="messages">
      <% @challenge.messages.each do |message| %>
        <%= render "messages/message", message: message %>
      <% end %>
    </div>

    <%= render "challenges/map", markers: @markers, challenge: @challenge %>


    <%= simple_form_for [@challenge, @message],
      html: { data: { action: "turbo:submit-end->challenge-subscription#resetForm" }, class: "message-bar" } do |f|
    %>

    <% if @challenge.won? %>
      <%= f.input :content,
        label: false,
        placeholder: "Write your message",
        wrapper_html: {class: "flex-grow-1"}
      %>
    <% else %>
      <%= f.input :content,
              label: false,
              placeholder: "Write your message",
              wrapper_html: {class: "flex-grow-1"},
              disabled: true
            %>
    <% end %>
      <%= f.submit "Send", class: "btn btn-primary mb-3" %>
    <% end %>
  </div>
